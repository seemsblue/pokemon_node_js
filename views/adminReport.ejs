<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Report</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <%- include('component/nav.ejs')%>
    <div class="container mt-5">
        <h2>Reports</h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Nickname</th>
                        <th>Title</th>
                        <th>Content</th>
                        <th>Time</th>
                        <th>기타 징지리링</th>
                    </tr>
                </thead>
                <tbody>
                    <% reports.forEach(report => { %>
                        <tr>
                            <td><%= report.user %></td>
                            <td><%= report.nickname %></td>
                            <td><%= report.title %></td>
                            <td><%= report.content %></td>
                            <td><%= report.time %></td>
                            <td>
                                <button class="btn btn-danger" onclick="confirmDelete('<%= report._id %>')">Delete</button>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function confirmDelete(reportId) {
            if (confirm("Are you sure you want to delete this report?")) {
                deleteReport(reportId);
            }
        }

        async function deleteReport(reportId) {
            try {
                const response = await fetch('/delete-report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'CSRF-Token': '<%= csrfToken %>' // CSRF 토큰 추가 필요 시
                    },
                    body: JSON.stringify({ id: reportId })
                });

                const result = await response.json();

                if (result.success) {
                    alert('삭제 완료');
                    location.reload(); // 페이지 리로드로 목록 갱신
                } else {
                    alert('못지움');
                }
            } catch (error) {
                console.error('에러:', error);
                alert('지우다가 에러남 난 몰라잉');
            }
        }
    </script>
</body>
</html>
